<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ModificarInformacionProducto.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;ProgramacionApp&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Vista</a> &gt; <span class="el_source">ModificarInformacionProducto.java</span></div><h1>ModificarInformacionProducto.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Vista;

import Controlador.Clases.IControladorProductos;
import Controlador.Clases.Utils;
import Controlador.DataTypes.DataCategoria;
import Controlador.DataTypes.DataEspecificacionProducto;
import Controlador.DataTypes.DataProveedor;
import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JInternalFrame;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.SpringLayout;
import static javax.swing.WindowConstants.DISPOSE_ON_CLOSE;
import javax.swing.table.TableModel;

/**
 *
 * @author rodro
 */
public class ModificarInformacionProducto extends JInternalFrame {

    private String nroRef;
    private JDialog dialog;
    private ElegirCategoriaComponente treePane;
    private final JPanel InfoPanel;
    private final JPanel offsetleft;
    private final IControladorProductos controlarProducto;

    private int index;
    private final JPanel listaProductosPanel;
    private Formulario form;
    private JButton saveButton;
    private JButton cancelarButton;
    private JPanel buttonContainer;
    private final JPanel thirdPanel;
    private SelectorDeImagenes sdi;

    /**
     * Creates new form VerInfoProductos
     */
<span class="nc" id="L65">    public ModificarInformacionProducto(IControladorProductos controlarProducto) {</span>

<span class="nc" id="L67">        this.controlarProducto = controlarProducto;</span>

<span class="nc" id="L69">        setBounds(00, 00, 1000, 700);</span>
<span class="nc" id="L70">        setVisible(true);</span>
<span class="nc" id="L71">        setLayout(new SpringLayout());</span>

<span class="nc" id="L73">        JButton elegirCategoria = new JButton(&quot;Elegir Categorias&quot;);</span>
<span class="nc" id="L74">        elegirCategoria.setSize(100, 40);</span>
<span class="nc" id="L75">        elegirCategoria.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L79">                openDialog();</span>
<span class="nc" id="L80">            }</span>
        });
<span class="nc" id="L82">        treePane = new ElegirCategoriaComponente(controlarProducto, true);</span>
<span class="nc" id="L83">        listaProductosPanel = new JPanel();</span>
<span class="nc" id="L84">        listaProductosPanel.setLayout(new GridLayout(1, 0));</span>

<span class="nc" id="L86">        offsetleft = new JPanel();</span>
<span class="nc" id="L87">        offsetleft.setLayout(new BorderLayout());</span>
<span class="nc" id="L88">        offsetleft.setSize(400, 500);</span>
<span class="nc" id="L89">        offsetleft.setVisible(true);</span>
<span class="nc" id="L90">        offsetleft.setLocation(0, 10);</span>
<span class="nc" id="L91">        offsetleft.add(elegirCategoria, BorderLayout.NORTH);</span>
<span class="nc" id="L92">        offsetleft.add(listaProductosPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L93">        buttonContainer = new JPanel(new FlowLayout());</span>
<span class="nc" id="L94">        buttonContainer.setSize(400, 500);</span>
<span class="nc" id="L95">        buttonContainer.setVisible(true);</span>

<span class="nc" id="L97">        saveButton = new JButton(&quot;Guardar&quot;);</span>
<span class="nc" id="L98">        saveButton.setVisible(false);</span>

<span class="nc" id="L100">        saveButton.setSize(100, 40);</span>
<span class="nc" id="L101">        saveButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L105">                save();</span>
<span class="nc" id="L106">            }</span>
        });
<span class="nc" id="L108">        setTitle(&quot;Modificar Informacion de Producto&quot;);</span>

<span class="nc" id="L110">        buttonContainer.add(saveButton);</span>
<span class="nc" id="L111">        cancelarButton = new JButton(&quot;Cancelar&quot;);</span>
<span class="nc" id="L112">        cancelarButton.setSize(100, 40);</span>
<span class="nc" id="L113">        cancelarButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L117">                cancel();</span>
<span class="nc" id="L118">            }</span>
        });
<span class="nc" id="L120">        buttonContainer.add(cancelarButton);</span>
<span class="nc" id="L121">        offsetleft.add(buttonContainer, BorderLayout.SOUTH);</span>
<span class="nc" id="L122">        InfoPanel = new JPanel();</span>
<span class="nc" id="L123">        InfoPanel.setSize(400, 500);</span>
<span class="nc" id="L124">        InfoPanel.setLayout(new BorderLayout());</span>

<span class="nc" id="L126">        thirdPanel = new JPanel();</span>
<span class="nc" id="L127">        thirdPanel.setSize(400, 500);</span>
<span class="nc" id="L128">        thirdPanel.setLayout(new BorderLayout());</span>

<span class="nc" id="L130">        add(offsetleft);</span>
<span class="nc" id="L131">        add(InfoPanel);</span>
<span class="nc" id="L132">        add(thirdPanel);</span>

<span class="nc" id="L134">        SpringUtilities.makeGrid(this.getContentPane(), 1, 3, 0, 0, 6, 6);</span>

<span class="nc" id="L136">    }</span>

    private void save() {
<span class="nc" id="L139">        String titulo = ((JTextField) form.getComponentByName(&quot;Titulo&quot;)).getText();</span>
<span class="nc" id="L140">        String NroRef = ((JTextField) form.getComponentByName(&quot;NroRef&quot;)).getText();</span>
<span class="nc" id="L141">        String descripcion = ((JTextField) form.getComponentByName(&quot;Descripcion&quot;)).getText();</span>
<span class="nc" id="L142">        String especificaciones = ((JTextArea) form.getComponentByName(&quot;Especificaciones&quot;)).getText();</span>
<span class="nc" id="L143">        String precio = ((JTextField) form.getComponentByName(&quot;Precio&quot;)).getText();</span>
<span class="nc" id="L144">        String Stock = ((JTextField) form.getComponentByName(&quot;Stock&quot;)).getText();</span>
<span class="nc" id="L145">        DataProveedor Proveedor = (DataProveedor) ((JComboBox) form.getComponentByName(&quot;Proveedor&quot;)).getSelectedItem();</span>
<span class="nc" id="L146">        HashSet&lt;String&gt; categorias = treePane.getSelectedCategories();</span>
<span class="nc" id="L147">        HashSet&lt;String&gt; imagenes = this.sdi.getListaDeImagenes();</span>
<span class="nc" id="L148">        Float precioReal = null;</span>
<span class="nc" id="L149">        Integer stockReal = null;</span>
        try {
<span class="nc" id="L151">            stockReal = Integer.parseInt(Stock);</span>
<span class="nc" id="L152">            precioReal = Float.parseFloat(precio);</span>
<span class="nc" id="L153">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L154">            JOptionPane.showMessageDialog(this, &quot;Precio y Stock deben ser un numero valido&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L155">            return;</span>
<span class="nc" id="L156">        }</span>
<span class="nc bnc" id="L157" title="All 4 branches missed.">        if (Utils.formatString(titulo).isEmpty() || Utils.formatString(NroRef).isEmpty()) {</span>
<span class="nc" id="L158">            JOptionPane.showMessageDialog(this, &quot;Titulo,NroRef,Proveedor son requeridos&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L159">            return;</span>
        }
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (categorias.isEmpty()) {</span>
<span class="nc" id="L162">            JOptionPane.showMessageDialog(this, &quot;Debe elegir una Categoria para el producto&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L163">            return;</span>
        }
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (Proveedor == null) {</span>
<span class="nc" id="L166">            JOptionPane.showMessageDialog(this, &quot;Debe elegir una Proveedor para el producto&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L167">            return;</span>
        }

<span class="nc" id="L170">        DataEspecificacionProducto espProducto = new DataEspecificacionProducto(NroRef, titulo, descripcion, Collections.synchronizedMap(new HashMap()), precioReal, Proveedor, new ArrayList&lt;String&gt;(), new ArrayList&lt;DataCategoria&gt;(), Collections.synchronizedMap(new HashMap()));</span>

<span class="nc" id="L172">        controlarProducto.modificarDatosEspecificacionProducto(espProducto);</span>

<span class="nc" id="L174">        controlarProducto.listarCategoriasAModificar().forEach((cat) -&gt; {</span>

            controlarProducto.borrarCategoriaAEspecificacion(cat.getNombre());
        });
<span class="nc" id="L178">        controlarProducto.ingresarEspecificacion(&quot;Especificacion&quot;, especificaciones);</span>
<span class="nc" id="L179">        controlarProducto.elegirProveedor(Proveedor.getNickname());</span>
<span class="nc" id="L180">        controlarProducto.ingresarDatosProductos(espProducto);</span>

<span class="nc" id="L182">        controlarProducto.agregarMultiplesProductosAutogenerados(stockReal);</span>

<span class="nc" id="L184">        categorias.forEach((cat) -&gt; {</span>
            controlarProducto.agregarCategoriaAEspecificacion(cat);
        });
<span class="nc" id="L187">        imagenes.forEach((img) -&gt; {</span>
            controlarProducto.agregarImagen(img);
        });

<span class="nc bnc" id="L191" title="All 2 branches missed.">        if (controlarProducto.validarInfo()) {</span>
            try {
<span class="nc" id="L193">                controlarProducto.guardarEspProductoModificado();</span>
<span class="nc" id="L194">                JOptionPane.showMessageDialog(this, &quot;Su Producto se ha creado correctamente&quot;, &quot;Validacion&quot;, JOptionPane.INFORMATION_MESSAGE);</span>
<span class="nc" id="L195">                dispose();</span>
<span class="nc" id="L196">            } catch (Exception e) {</span>
<span class="nc" id="L197">                JOptionPane.showMessageDialog(this, &quot;Sus datos no son correctos, Verifique&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>

<span class="nc" id="L199">            }</span>
        } else {

<span class="nc" id="L202">            JOptionPane.showMessageDialog(this, &quot;Sus datos no son correctos, Verifique&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>

        }

<span class="nc" id="L206">    }</span>

    private void cancel() {
<span class="nc" id="L209">        dispose();</span>
<span class="nc" id="L210">    }</span>

    private void listarProductos() {
<span class="nc" id="L213">        listaProductosPanel.removeAll();</span>
<span class="nc" id="L214">        listaProductosPanel.revalidate();</span>
<span class="nc" id="L215">        listaProductosPanel.repaint();</span>

<span class="nc bnc" id="L217" title="All 2 branches missed.">        if (!treePane.getSelectedCategories().isEmpty()) {</span>
<span class="nc" id="L218">            String catName = treePane.getSelectedCategories().iterator().next();</span>
<span class="nc" id="L219">            controlarProducto.elegirCategoria(catName);</span>
        }
<span class="nc" id="L221">        Object[][] rowData = new Object[controlarProducto.listarProductosCategoria().size()][2];</span>
<span class="nc" id="L222">        index = 0;</span>

<span class="nc" id="L224">        controlarProducto.listarProductosCategoria().forEach((c) -&gt; {</span>
            Object[] obj = {c.getNroReferencia(), c.getNombre()};

            rowData[index] = obj;
            index++;
        });
<span class="nc" id="L230">        String[] columnNames = {&quot;NroRef&quot;, &quot;Nombre&quot;};</span>

<span class="nc" id="L232">        JTable listaProductos = new JTable(rowData, columnNames);</span>
<span class="nc" id="L233">        listaProductos.setPreferredScrollableViewportSize(new Dimension(500, 100));</span>
<span class="nc" id="L234">        listaProductos.setFillsViewportHeight(true);</span>

<span class="nc" id="L236">        listaProductos.addMouseListener(new MouseAdapter() {</span>
            @Override
            public void mouseClicked(MouseEvent e) {
<span class="nc" id="L239">                printDataProducto(listaProductos);</span>
<span class="nc" id="L240">            }</span>
        });

<span class="nc" id="L243">        JScrollPane scrollPane = new JScrollPane(listaProductos);</span>
<span class="nc" id="L244">        listaProductosPanel.add(scrollPane);</span>
<span class="nc" id="L245">        listaProductosPanel.revalidate();</span>
<span class="nc" id="L246">        listaProductosPanel.repaint();</span>
<span class="nc" id="L247">        revalidate();</span>
<span class="nc" id="L248">        repaint();</span>
<span class="nc" id="L249">    }</span>

    private void printDataProducto(JTable listaProductos) {

<span class="nc" id="L253">        InfoPanel.removeAll();</span>
<span class="nc" id="L254">        thirdPanel.removeAll();</span>
<span class="nc" id="L255">        TableModel model = listaProductos.getModel();</span>
<span class="nc" id="L256">        int row = listaProductos.getSelectedRow();</span>
<span class="nc" id="L257">        String nroRef = (String) model.getValueAt(row, 0);</span>
<span class="nc" id="L258">        controlarProducto.elegirEspProducto(nroRef);</span>
<span class="nc" id="L259">        DataEspecificacionProducto dataProducto = controlarProducto.mostrarDatosProducto(nroRef);</span>
<span class="nc" id="L260">        form = new Formulario(true);</span>
<span class="nc" id="L261">        form.addField(&quot;Titulo&quot;, &quot;text&quot;, null, dataProducto.getNombre());</span>
<span class="nc" id="L262">        form.addField(&quot;NroRef&quot;, &quot;text&quot;, null, dataProducto.getNroReferencia());</span>
<span class="nc" id="L263">        form.addField(&quot;Descripcion&quot;, &quot;text&quot;, null, dataProducto.getDescripcion());</span>
<span class="nc" id="L264">        Iterator it = dataProducto.getEspecificacion().values().iterator();</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (it.hasNext()) {</span>
<span class="nc" id="L266">            form.addField(&quot;Especificaciones&quot;, &quot;textarea&quot;, null, it.next().toString());</span>
        } else {
<span class="nc" id="L268">            form.addField(&quot;Especificaciones&quot;, &quot;textarea&quot;);</span>
        }
<span class="nc" id="L270">        form.addField(&quot;Precio&quot;, &quot;text&quot;, null, String.valueOf(dataProducto.getPrecio()));</span>
<span class="nc" id="L271">        form.addField(&quot;Stock&quot;, &quot;text&quot;, null, String.valueOf(dataProducto.getProductos().size()));</span>
<span class="nc" id="L272">        form.addField(&quot;Proveedor&quot;, &quot;combo&quot;, controlarProducto.listarProveedores().toArray(), null);</span>

<span class="nc" id="L274">        ((JComboBox) form.getComponentByName(&quot;Proveedor&quot;)).setSelectedItem(dataProducto.getProveedor());</span>

<span class="nc" id="L276">        treePane = new ElegirCategoriaComponente(controlarProducto, false);</span>

<span class="nc" id="L278">        sdi = new SelectorDeImagenes();</span>
<span class="nc" id="L279">        sdi.setLocation(700, 10);</span>

<span class="nc" id="L281">        JButton elegirCategoria = new JButton(&quot;Elegir Categorias&quot;);</span>
<span class="nc" id="L282">        elegirCategoria.setSize(100, 40);</span>
<span class="nc" id="L283">        elegirCategoria.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L287">                openDialog();</span>
<span class="nc" id="L288">            }</span>
        });
<span class="nc" id="L290">        InfoPanel.add(elegirCategoria, BorderLayout.NORTH);</span>
<span class="nc" id="L291">        InfoPanel.add(form, BorderLayout.CENTER);</span>
<span class="nc" id="L292">        InfoPanel.revalidate();</span>
<span class="nc" id="L293">        InfoPanel.repaint();</span>

<span class="nc" id="L295">        thirdPanel.add(sdi);</span>
<span class="nc" id="L296">        thirdPanel.revalidate();</span>
<span class="nc" id="L297">        thirdPanel.repaint();</span>
<span class="nc" id="L298">        saveButton.setVisible(true);</span>

<span class="nc" id="L300">        sdi.load(dataProducto.getImagenes());</span>
<span class="nc" id="L301">    }</span>

    private void openDialog() {
<span class="nc" id="L304">        dialog = new JDialog();</span>
<span class="nc" id="L305">        dialog.setTitle(&quot;Elegir Categoria&quot;);</span>

<span class="nc" id="L307">        JButton aceptarButton = new JButton(&quot;Listo!!&quot;);</span>
<span class="nc" id="L308">        aceptarButton.setSize(80, 30);</span>
<span class="nc" id="L309">        aceptarButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L313">                dialog.dispose();</span>
<span class="nc" id="L314">                listarProductos();</span>
<span class="nc" id="L315">            }</span>
        });
<span class="nc" id="L317">        dialog.getContentPane().setSize(400, 400);</span>
<span class="nc" id="L318">        dialog.getContentPane().add(treePane, BorderLayout.CENTER);</span>
<span class="nc" id="L319">        dialog.getContentPane().add(aceptarButton, BorderLayout.SOUTH);</span>
<span class="nc" id="L320">        dialog.setDefaultCloseOperation(DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L321">        dialog.setSize(new Dimension(400, 400));</span>
<span class="nc" id="L322">        dialog.setLocationRelativeTo(this);</span>
<span class="nc" id="L323">        dialog.setModal(true);</span>
<span class="nc" id="L324">        dialog.setVisible(true);</span>

<span class="nc" id="L326">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>