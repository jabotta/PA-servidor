<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RegistrarProducto.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;ProgramacionApp&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Vista</a> &gt; <span class="el_source">RegistrarProducto.java</span></div><h1>RegistrarProducto.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Vista;

import Controlador.Clases.Categoria;
import Controlador.Clases.Fabrica;
import Controlador.Clases.IControladorProductos;
import static Controlador.Clases.Main.idUsuariosControlador;
import Controlador.Clases.ManejadorCategorias;
import Controlador.Clases.ManejadorEspProductos;
import Controlador.Clases.Utils;
import Controlador.DataTypes.DataCategoria;
import Controlador.DataTypes.DataEspecificacionProducto;
import Controlador.DataTypes.DataProducto;
import Controlador.DataTypes.DataProveedor;
import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.Frame;
import java.awt.Graphics;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import javax.swing.ComboBoxModel;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JDialog;

import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.JTree;
import javax.swing.SpringLayout;
import javax.swing.border.Border;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.tree.DefaultMutableTreeNode;

/**
 *
 * @author rodro
 */
public class RegistrarProducto extends javax.swing.JInternalFrame {

    private JDialog dialog;
    private ElegirCategoriaComponente treePane;
    private final Formulario form;
    private final IControladorProductos controlarProducto;
    private final SelectorDeImagenes sdi;

<span class="nc" id="L66">    RegistrarProducto(IControladorProductos controlarProducto) {</span>

<span class="nc" id="L68">        this.controlarProducto = controlarProducto;</span>
     
<span class="nc" id="L70">        setBounds(50, 50, 800, 500);</span>
<span class="nc" id="L71">        setVisible(true);</span>
<span class="nc" id="L72">        setLayout(new SpringLayout());</span>

<span class="nc" id="L74">        setTitle(&quot;Registrar Producto&quot;);</span>
 
<span class="nc" id="L76">        form = new Formulario();</span>

<span class="nc" id="L78">        form.addField(&quot;Titulo&quot;, &quot;text&quot;);</span>
<span class="nc" id="L79">        form.addField(&quot;NroRef&quot;, &quot;text&quot;);</span>
<span class="nc" id="L80">        form.addField(&quot;Descripcion&quot;, &quot;text&quot;);</span>
<span class="nc" id="L81">        form.addField(&quot;Especificaciones&quot;, &quot;textarea&quot;);</span>
<span class="nc" id="L82">        form.addField(&quot;Precio&quot;, &quot;text&quot;);</span>
<span class="nc" id="L83">        form.addField(&quot;Stock&quot;, &quot;text&quot;);</span>
<span class="nc" id="L84">        form.addField(&quot;Proveedor&quot;, &quot;combo&quot;, controlarProducto.listarProveedores().toArray(),null);</span>


<span class="nc" id="L87">        treePane = new ElegirCategoriaComponente(controlarProducto, false);</span>
<span class="nc" id="L88">        sdi = new SelectorDeImagenes();</span>
<span class="nc" id="L89">        sdi.setLocation(700, 10);</span>


<span class="nc" id="L92">        JButton elegirCategoria = new JButton(&quot;Elegir Categorias&quot;);</span>
<span class="nc" id="L93">        elegirCategoria.setSize(100, 40);</span>
<span class="nc" id="L94">        elegirCategoria.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L98">                openDialog();</span>
<span class="nc" id="L99">            }</span>
        });
<span class="nc" id="L101">        JPanel buttonsPanel = new JPanel();</span>
<span class="nc" id="L102">        buttonsPanel.setSize(200, 200);</span>
<span class="nc" id="L103">        buttonsPanel.setVisible(true);</span>
<span class="nc" id="L104">        JButton salvar = new JButton(&quot;Guardar&quot;);</span>
<span class="nc" id="L105">        salvar.setSize(80, 30);</span>
<span class="nc" id="L106">        salvar.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L110">                validar();</span>
<span class="nc" id="L111">            }</span>
        });
<span class="nc" id="L113">        JButton cancelar = new JButton(&quot;Cancelar&quot;);</span>
<span class="nc" id="L114">        cancelar.setSize(80, 30);</span>
<span class="nc" id="L115">        cancelar.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L119">                cancelar();</span>
<span class="nc" id="L120">            }</span>
        });
<span class="nc" id="L122">        buttonsPanel.add(salvar);</span>
<span class="nc" id="L123">        buttonsPanel.add(cancelar);</span>

<span class="nc" id="L125">        JPanel offsetleft = new JPanel();</span>
<span class="nc" id="L126">        offsetleft.setLayout(new BorderLayout());</span>
<span class="nc" id="L127">        offsetleft.setSize(400, 500);</span>
<span class="nc" id="L128">        offsetleft.setVisible(true);</span>
<span class="nc" id="L129">        offsetleft.setLocation(0, 10);</span>
<span class="nc" id="L130">        offsetleft.add(buttonsPanel, BorderLayout.SOUTH);</span>
<span class="nc" id="L131">        offsetleft.add(form, BorderLayout.CENTER);</span>
<span class="nc" id="L132">        offsetleft.add(elegirCategoria, BorderLayout.NORTH);</span>

<span class="nc" id="L134">        add(offsetleft);</span>
<span class="nc" id="L135">        add(sdi);</span>

<span class="nc" id="L137">        SpringUtilities.makeGrid(this.getContentPane(), 1, 2, 0, 0, 6, 6);</span>

<span class="nc" id="L139">    }</span>

    private void cancelar() {
<span class="nc" id="L142">        this.dispose();</span>

<span class="nc" id="L144">    }</span>

    private void validar() {
<span class="nc" id="L147">        String titulo = ((JTextField) form.getComponentByName(&quot;Titulo&quot;)).getText();</span>
<span class="nc" id="L148">        String NroRef = ((JTextField) form.getComponentByName(&quot;NroRef&quot;)).getText();</span>
<span class="nc" id="L149">        String descripcion = ((JTextField) form.getComponentByName(&quot;Descripcion&quot;)).getText();</span>
<span class="nc" id="L150">        String especificaciones = ((JTextArea) form.getComponentByName(&quot;Especificaciones&quot;)).getText();</span>
<span class="nc" id="L151">        String precio = ((JTextField) form.getComponentByName(&quot;Precio&quot;)).getText();</span>
<span class="nc" id="L152">        String Stock = ((JTextField) form.getComponentByName(&quot;Stock&quot;)).getText();</span>
<span class="nc" id="L153">        DataProveedor Proveedor = (DataProveedor) ((JComboBox) form.getComponentByName(&quot;Proveedor&quot;)).getSelectedItem();</span>
<span class="nc" id="L154">        HashSet&lt;String&gt; categorias = treePane.getSelectedCategories();</span>
<span class="nc" id="L155">        HashSet&lt;String&gt; imagenes = this.sdi.getListaDeImagenes();</span>
<span class="nc" id="L156">        Float precioReal = null;</span>
<span class="nc" id="L157">        Integer stockReal = null;</span>
        try {
<span class="nc" id="L159">            stockReal = Integer.parseInt(Stock);</span>
<span class="nc" id="L160">            precioReal = Float.parseFloat(precio);</span>
<span class="nc" id="L161">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L162">            JOptionPane.showMessageDialog(this, &quot;Precio y Stock deben ser un numero valido&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L163">            return;</span>
<span class="nc" id="L164">        }</span>
<span class="nc bnc" id="L165" title="All 4 branches missed.">        if (Utils.formatString(titulo).isEmpty() || Utils.formatString(NroRef).isEmpty()) {</span>
<span class="nc" id="L166">            JOptionPane.showMessageDialog(this, &quot;Titulo,NroRef,Proveedor son requeridos&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L167">            return;</span>
        }
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (categorias.isEmpty()) {</span>
<span class="nc" id="L170">            JOptionPane.showMessageDialog(this, &quot;Debe elegir una Categoria para el producto&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L171">            return;</span>
        }
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (Proveedor == null) {</span>
<span class="nc" id="L174">            JOptionPane.showMessageDialog(this, &quot;Debe elegir una Proveedor para el producto&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L175">            return;</span>
        }

<span class="nc" id="L178">        DataEspecificacionProducto espProducto = new DataEspecificacionProducto(NroRef, titulo, descripcion, Collections.synchronizedMap(new HashMap()), precioReal, Proveedor, new ArrayList&lt;String&gt;(), new ArrayList&lt;DataCategoria&gt;(), Collections.synchronizedMap(new HashMap()));</span>
<span class="nc" id="L179">        controlarProducto.elegirProveedor(Proveedor.getNickname());</span>
<span class="nc" id="L180">        controlarProducto.ingresarDatosProductos(espProducto);</span>
        
<span class="nc" id="L182">        controlarProducto.ingresarEspecificacion(&quot;Especificacion&quot;, especificaciones);</span>

<span class="nc" id="L184">        controlarProducto.agregarMultiplesProductosAutogenerados(stockReal);</span>

<span class="nc" id="L186">        categorias.forEach((cat) -&gt; {</span>
            controlarProducto.agregarCategoriaAEspecificacion(cat);
        });
<span class="nc" id="L189">        imagenes.forEach((img) -&gt; { </span>
            controlarProducto.agregarImagen(img);
        });
<span class="nc bnc" id="L192" title="All 2 branches missed.">        if (controlarProducto.controlarErrores()) {</span>
            try {
<span class="nc" id="L194">                controlarProducto.guardarProducto();</span>
<span class="nc" id="L195">                JOptionPane.showMessageDialog(this, &quot;Su Producto se ha creado correctamente&quot;, &quot;Validacion&quot;, JOptionPane.INFORMATION_MESSAGE);</span>
<span class="nc" id="L196">                dispose();</span>
<span class="nc" id="L197">            } catch (Exception e) {</span>
<span class="nc" id="L198">                JOptionPane.showMessageDialog(this, &quot;Sus datos no son correctos, Verifique&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>

<span class="nc" id="L200">            }</span>
        }else{
           
<span class="nc" id="L203">            JOptionPane.showMessageDialog(this, &quot;Sus datos no son correctos, Verifique&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>

        }

<span class="nc" id="L207">    }</span>

    private void openDialog() {
<span class="nc" id="L210">        dialog = new JDialog();</span>
<span class="nc" id="L211">        dialog.setTitle(&quot;Elegir Categoria&quot;);</span>

<span class="nc" id="L213">        JButton aceptarButton = new JButton(&quot;Listo!!&quot;);</span>
<span class="nc" id="L214">        aceptarButton.setSize(80, 30);</span>
<span class="nc" id="L215">        aceptarButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L219">                dialog.dispose();</span>
<span class="nc" id="L220">            }</span>
        });
<span class="nc" id="L222">        dialog.getContentPane().setSize(400, 400);</span>
<span class="nc" id="L223">        dialog.getContentPane().add(treePane, BorderLayout.CENTER);</span>
<span class="nc" id="L224">        dialog.getContentPane().add(aceptarButton, BorderLayout.SOUTH);</span>
<span class="nc" id="L225">        dialog.setDefaultCloseOperation(DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L226">        dialog.setSize(new Dimension(400, 400));</span>
<span class="nc" id="L227">        dialog.setLocationRelativeTo(this);</span>
<span class="nc" id="L228">        dialog.setModal(true);</span>
<span class="nc" id="L229">        dialog.setVisible(true);</span>

<span class="nc" id="L231">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>