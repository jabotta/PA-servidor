<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GenerarOrdenDeCompra.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;ProgramacionApp&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Vista</a> &gt; <span class="el_source">GenerarOrdenDeCompra.java</span></div><h1>GenerarOrdenDeCompra.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Vista;

import Controlador.Clases.IControladorOrdenes;
import Controlador.Clases.ManejadorOrdenes;
import Controlador.DataTypes.DataEspecificacionProducto;
import Controlador.DataTypes.DataOrdenCompra;
import static Vista.VentanaPrincipal.controlarProducto;
import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.ArrayList;
import java.util.function.Predicate;
import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JInternalFrame;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.SpringLayout;
import static javax.swing.WindowConstants.DISPOSE_ON_CLOSE;
import javax.swing.table.TableModel;

/**
 *
 * @author rodro
 */
public class GenerarOrdenDeCompra extends JInternalFrame {

    private final IControladorOrdenes controlarOrden;
    private final ElegirCategoriaComponente treePane;
    private final JPanel listaProductosPanel;
    private final JPanel offsetleft;
    private final JPanel buttonContainer;
    private final JButton saveButton;
    private final JButton cancelarButton;
    private final JPanel InfoPanel;
    private final JPanel thirdPanel;
    private JDialog dialog;
    private int index;
    private Formulario form;
    private JTable carrito;
    private Item currentItem;
    private ArrayList&lt;Item&gt; carritoArray;
    private int indCompra;
    private final JPanel buttonContainerNorth;
    private JTable listarClientes;

<span class="nc" id="L60">    GenerarOrdenDeCompra(IControladorOrdenes controlarOrden) {</span>
<span class="nc" id="L61">        this.controlarOrden = controlarOrden;</span>
<span class="nc" id="L62">        setBounds(50, 50, 1000, 500);</span>
<span class="nc" id="L63">        setVisible(true);</span>
<span class="nc" id="L64">        setLayout(new SpringLayout());</span>

<span class="nc" id="L66">        setTitle(&quot;Crear Orden&quot;);</span>

<span class="nc" id="L68">        carritoArray = new ArrayList();</span>

<span class="nc" id="L70">        JButton elegirCategoria = new JButton(&quot;Elegir Categorias&quot;);</span>
<span class="nc" id="L71">        elegirCategoria.setSize(100, 40);</span>
<span class="nc" id="L72">        elegirCategoria.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L76">                openDialog();</span>
<span class="nc" id="L77">            }</span>
        });
<span class="nc" id="L79">       JButton elegirCliente = new JButton(&quot;Elegir Cliente&quot;);</span>
<span class="nc" id="L80">        elegirCliente.setSize(100, 40);</span>
<span class="nc" id="L81">        elegirCliente.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L85">                listarYElegirCliente();</span>
<span class="nc" id="L86">            }</span>
        });
<span class="nc" id="L88">        treePane = new ElegirCategoriaComponente(controlarProducto, true);</span>
<span class="nc" id="L89">        listaProductosPanel = new JPanel();</span>
<span class="nc" id="L90">        listaProductosPanel.setLayout(new GridLayout(1, 0));</span>
<span class="nc" id="L91">        buttonContainerNorth = new JPanel(new FlowLayout());</span>
<span class="nc" id="L92">        buttonContainerNorth.setSize(400, 500);</span>
<span class="nc" id="L93">        buttonContainerNorth.setVisible(true);</span>
<span class="nc" id="L94">        buttonContainerNorth.add(elegirCategoria);</span>
<span class="nc" id="L95">        buttonContainerNorth.add(elegirCliente);</span>
        
<span class="nc" id="L97">        offsetleft = new JPanel();</span>
<span class="nc" id="L98">        offsetleft.setLayout(new BorderLayout());</span>
<span class="nc" id="L99">        offsetleft.setSize(400, 500);</span>
<span class="nc" id="L100">        offsetleft.setVisible(true);</span>
<span class="nc" id="L101">        offsetleft.setLocation(0, 10);</span>
<span class="nc" id="L102">        offsetleft.add(buttonContainerNorth, BorderLayout.NORTH);</span>
<span class="nc" id="L103">        offsetleft.add(listaProductosPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L104">        buttonContainer = new JPanel(new FlowLayout());</span>
<span class="nc" id="L105">        buttonContainer.setSize(400, 500);</span>
<span class="nc" id="L106">        buttonContainer.setVisible(true);</span>

<span class="nc" id="L108">        saveButton = new JButton(&quot;Guardar&quot;);</span>
<span class="nc" id="L109">        saveButton.setVisible(false);</span>

<span class="nc" id="L111">        saveButton.setSize(100, 40);</span>
<span class="nc" id="L112">        saveButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L116">                ordenar();</span>
<span class="nc" id="L117">            }</span>
        });
<span class="nc" id="L119">        setTitle(&quot;Modificar Informacion de Producto&quot;);</span>

<span class="nc" id="L121">        buttonContainer.add(saveButton);</span>
<span class="nc" id="L122">        cancelarButton = new JButton(&quot;Cancelar&quot;);</span>
<span class="nc" id="L123">        cancelarButton.setSize(100, 40);</span>
<span class="nc" id="L124">        cancelarButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L128">                cancel();</span>
<span class="nc" id="L129">            }</span>

        });
<span class="nc" id="L132">        buttonContainer.add(cancelarButton);</span>
<span class="nc" id="L133">        offsetleft.add(buttonContainer, BorderLayout.SOUTH);</span>
<span class="nc" id="L134">        InfoPanel = new JPanel();</span>
<span class="nc" id="L135">        InfoPanel.setSize(400, 500);</span>
<span class="nc" id="L136">        InfoPanel.setLayout(new BorderLayout());</span>

<span class="nc" id="L138">        thirdPanel = new JPanel();</span>
<span class="nc" id="L139">        thirdPanel.setSize(400, 500);</span>
<span class="nc" id="L140">        thirdPanel.setLayout(new BorderLayout());</span>

<span class="nc" id="L142">        add(offsetleft);</span>
<span class="nc" id="L143">        add(InfoPanel);</span>
<span class="nc" id="L144">        add(thirdPanel);</span>

<span class="nc" id="L146">        SpringUtilities.makeGrid(this.getContentPane(), 1, 3, 0, 0, 6, 6);</span>

<span class="nc" id="L148">    }</span>
    private void listarYElegirCliente(){
<span class="nc" id="L150">        dialog = new JDialog();</span>
<span class="nc" id="L151">        dialog.setTitle(&quot;Elegir Cliente&quot;);</span>

<span class="nc" id="L153">        JButton aceptarButton = new JButton(&quot;Listo!!&quot;);</span>
<span class="nc" id="L154">        aceptarButton.setSize(80, 30);</span>
<span class="nc" id="L155">        aceptarButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L159">                dialog.dispose();</span>
<span class="nc" id="L160">                elegirCliente();</span>
<span class="nc" id="L161">            }</span>
        });
<span class="nc" id="L163">        Object[][] rowData = new Object[controlarOrden.listarClientes().size()][2];</span>
<span class="nc" id="L164">        index = 0;</span>
<span class="nc" id="L165">        controlarOrden.listarClientes().stream().forEach((cliente) -&gt; {</span>
             Object[] obj={cliente.getNickname(),cliente.getEmail()};
             rowData[index] = obj;
             index++;        
        });
<span class="nc" id="L170">        String[] columnNames={&quot;Nickname&quot;,&quot;Email&quot;};</span>
<span class="nc" id="L171">        listarClientes = new JTable(rowData, columnNames);</span>
<span class="nc" id="L172">        listarClientes.setPreferredScrollableViewportSize(new Dimension(440, 100));</span>
<span class="nc" id="L173">        listarClientes.setFillsViewportHeight(true);</span>
<span class="nc" id="L174">        JScrollPane scrollPane = new JScrollPane(listarClientes);</span>
<span class="nc" id="L175">        JPanel clientesPane = new JPanel();</span>
<span class="nc" id="L176">        clientesPane.add(scrollPane);</span>
<span class="nc" id="L177">        clientesPane.revalidate();</span>
<span class="nc" id="L178">        clientesPane.repaint();</span>
<span class="nc" id="L179">        clientesPane.setSize(400, 400);</span>
<span class="nc" id="L180">        dialog.getContentPane().setSize(440, 400);</span>
<span class="nc" id="L181">        dialog.getContentPane().add(clientesPane, BorderLayout.CENTER);</span>
<span class="nc" id="L182">        dialog.getContentPane().add(aceptarButton, BorderLayout.SOUTH);</span>
<span class="nc" id="L183">        dialog.setDefaultCloseOperation(DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L184">        dialog.setSize(new Dimension(500, 400));</span>
<span class="nc" id="L185">        dialog.setLocationRelativeTo(this);</span>
<span class="nc" id="L186">        dialog.setModal(true);</span>
<span class="nc" id="L187">        dialog.setVisible(true);</span>
<span class="nc" id="L188">    }</span>
    private void elegirCliente(){
<span class="nc" id="L190">        TableModel model = listarClientes.getModel();</span>
<span class="nc" id="L191">        int row = listarClientes.getSelectedRow();</span>
<span class="nc" id="L192">        String Nickname = (String) model.getValueAt(row, 0);</span>
<span class="nc" id="L193">        String Email = (String) model.getValueAt(row, 1);</span>
<span class="nc" id="L194">        controlarOrden.elegirCliente(Nickname); </span>
<span class="nc" id="L195">    }</span>
    private void cancel() {
<span class="nc" id="L197">        dispose();</span>
<span class="nc" id="L198">    }</span>

    private void ordenar() {
<span class="nc" id="L201">        Integer id= controlarOrden.getNextId();</span>
<span class="nc" id="L202">        DataOrdenCompra dataOrden = new DataOrdenCompra(id);</span>
<span class="nc" id="L203">        controlarOrden.guardarOrden(dataOrden);</span>
        
<span class="nc" id="L205">        System.out.println(ManejadorOrdenes.getInstance().obtenerOrdenes().get(id));</span>
<span class="nc" id="L206">        JOptionPane.showMessageDialog(this, &quot;Su Orden se ha creado correctamente&quot;, &quot;Validacion&quot;, JOptionPane.INFORMATION_MESSAGE);</span>

<span class="nc" id="L208">        dispose();</span>
<span class="nc" id="L209">    }</span>

    private void openDialog() {
<span class="nc" id="L212">        dialog = new JDialog();</span>
<span class="nc" id="L213">        dialog.setTitle(&quot;Elegir Categoria&quot;);</span>

<span class="nc" id="L215">        JButton aceptarButton = new JButton(&quot;Listo!!&quot;);</span>
<span class="nc" id="L216">        aceptarButton.setSize(80, 30);</span>
<span class="nc" id="L217">        aceptarButton.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L221">                dialog.dispose();</span>
<span class="nc" id="L222">                listarProductos();</span>
<span class="nc" id="L223">            }</span>
        });
<span class="nc" id="L225">        dialog.getContentPane().setSize(400, 400);</span>
<span class="nc" id="L226">        dialog.getContentPane().add(treePane, BorderLayout.CENTER);</span>
<span class="nc" id="L227">        dialog.getContentPane().add(aceptarButton, BorderLayout.SOUTH);</span>
<span class="nc" id="L228">        dialog.setDefaultCloseOperation(DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L229">        dialog.setSize(new Dimension(400, 400));</span>
<span class="nc" id="L230">        dialog.setLocationRelativeTo(this);</span>
<span class="nc" id="L231">        dialog.setModal(true);</span>
<span class="nc" id="L232">        dialog.setVisible(true);</span>

<span class="nc" id="L234">    }</span>

    private void listarProductos() {
<span class="nc" id="L237">        listaProductosPanel.removeAll();</span>
<span class="nc" id="L238">        listaProductosPanel.revalidate();</span>
<span class="nc" id="L239">        listaProductosPanel.repaint();</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">        if (!treePane.getSelectedCategories().isEmpty()) {</span>
<span class="nc" id="L242">            String catName = treePane.getSelectedCategories().iterator().next();</span>
<span class="nc" id="L243">            controlarProducto.elegirCategoria(catName);</span>
        }
<span class="nc" id="L245">        Object[][] rowData = new Object[controlarProducto.listarProductosCategoria().size()][2];</span>
<span class="nc" id="L246">        index = 0;</span>

<span class="nc" id="L248">        controlarProducto.listarProductosCategoria().forEach((c) -&gt; {</span>
            Object[] obj = {c.getNroReferencia(), c.getNombre()};

            rowData[index] = obj;
            index++;
        });
<span class="nc" id="L254">        String[] columnNames = {&quot;NroRef&quot;, &quot;Nombre&quot;};</span>

<span class="nc" id="L256">        JTable listaProductos = new JTable(rowData, columnNames);</span>
<span class="nc" id="L257">        listaProductos.setPreferredScrollableViewportSize(new Dimension(500, 100));</span>
<span class="nc" id="L258">        listaProductos.setFillsViewportHeight(true);</span>

<span class="nc" id="L260">        listaProductos.addMouseListener(new MouseAdapter() {</span>
            @Override
            public void mouseClicked(MouseEvent e) {
<span class="nc" id="L263">                printDataProducto(listaProductos);</span>
<span class="nc" id="L264">            }</span>
        });

<span class="nc" id="L267">        JScrollPane scrollPane = new JScrollPane(listaProductos);</span>
<span class="nc" id="L268">        listaProductosPanel.add(scrollPane);</span>
<span class="nc" id="L269">        listaProductosPanel.revalidate();</span>
<span class="nc" id="L270">        listaProductosPanel.repaint();</span>
<span class="nc" id="L271">        revalidate();</span>
<span class="nc" id="L272">        repaint();</span>
<span class="nc" id="L273">    }</span>

    private void printDataProducto(JTable listaProductos) {

<span class="nc" id="L277">        InfoPanel.removeAll();</span>

<span class="nc" id="L279">        TableModel model = listaProductos.getModel();</span>
<span class="nc" id="L280">        int row = listaProductos.getSelectedRow();</span>
<span class="nc" id="L281">        String nroRef = (String) model.getValueAt(row, 0);</span>
<span class="nc" id="L282">        String nombre = (String) model.getValueAt(row, 1);</span>
<span class="nc" id="L283">        currentItem = new Item(nroRef, nombre, 0);</span>
//        controlarProducto.elegirEspProducto(nroRef);
//        DataEspecificacionProducto dataProducto = controlarProducto.mostrarDatosProducto(nroRef);

<span class="nc" id="L287">        form = new Formulario(true);</span>
<span class="nc" id="L288">        form.addField(&quot;Cantidad&quot;, &quot;text&quot;);</span>

<span class="nc" id="L290">        JButton agregarCarrito = new JButton(&quot;Agregar&quot;);</span>
<span class="nc" id="L291">        agregarCarrito.setSize(100, 40);</span>
<span class="nc" id="L292">        agregarCarrito.addActionListener(new ActionListener() {</span>

            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L296">                agregar();</span>
<span class="nc" id="L297">            }</span>
        });
<span class="nc" id="L299">        InfoPanel.add(agregarCarrito, BorderLayout.SOUTH);</span>
<span class="nc" id="L300">        InfoPanel.add(form, BorderLayout.CENTER);</span>
<span class="nc" id="L301">        InfoPanel.revalidate();</span>
<span class="nc" id="L302">        InfoPanel.repaint();</span>

<span class="nc" id="L304">        saveButton.setVisible(true);</span>
<span class="nc" id="L305">    }</span>

    public void cancelarLinea(MouseEvent e) {

<span class="nc" id="L309">        TableModel model = carrito.getModel();</span>
<span class="nc" id="L310">        int col = carrito.getSelectedColumn();</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">        if (col == 3) {</span>
<span class="nc" id="L312">            String ref = (String) model.getValueAt(carrito.getSelectedRow(), 0);</span>
<span class="nc" id="L313">            Predicate&lt;Item&gt; pre = new Predicate&lt;Item&gt;() {</span>

                @Override
                public boolean test(Item t) {
<span class="nc bnc" id="L317" title="All 2 branches missed.">                    return t.nroRef == ref;</span>
                }
            };
<span class="nc" id="L320">            controlarOrden.removerEspecificacionProducto(ref);</span>
<span class="nc" id="L321">            carritoArray.removeIf(pre);</span>
<span class="nc" id="L322">            renderCarrito();</span>
        }
<span class="nc" id="L324">    }</span>

    public void agregar() {

<span class="nc" id="L328">        String cantidad = ((JTextField) form.getComponentByName(&quot;Cantidad&quot;)).getText();</span>
<span class="nc" id="L329">        Integer cantidadReal = null;</span>

        try {
<span class="nc" id="L332">            cantidadReal = Integer.parseInt(cantidad);</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">            if (cantidadReal &lt;= 0) {</span>
<span class="nc" id="L334">                JOptionPane.showMessageDialog(this, &quot;Cantidad debe ser un numero Entero&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>

            } else {
<span class="nc" id="L337">                currentItem.cantidad = cantidadReal;</span>
<span class="nc" id="L338">                controlarOrden.elegirEspecificacionProducto(currentItem.nroRef);</span>
<span class="nc" id="L339">                controlarOrden.elegirCantidadProducto(currentItem.cantidad);</span>
<span class="nc" id="L340">                controlarOrden.generarItemOrden();</span>
<span class="nc" id="L341">                carritoArray.add(currentItem);</span>
<span class="nc" id="L342">                renderCarrito();</span>
            }
<span class="nc" id="L344">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L345">            JOptionPane.showMessageDialog(this, &quot;Cantidad debe ser un numero Entero&quot;, &quot;Validacion&quot;, JOptionPane.ERROR_MESSAGE);</span>

<span class="nc" id="L347">        }</span>

<span class="nc" id="L349">    }</span>

    private void renderCarrito() {
<span class="nc" id="L352">        thirdPanel.removeAll();</span>

<span class="nc" id="L354">        String[] columnNames = {&quot;NroRef&quot;, &quot;Nombre&quot;, &quot;Cantidad&quot;, &quot;Cancelar&quot;};</span>
<span class="nc" id="L355">        Object[][] rowData = new Object[carritoArray.size()][4];</span>
<span class="nc" id="L356">        indCompra = 0;</span>
<span class="nc" id="L357">        carritoArray.forEach((it) -&gt; {</span>
            Object[] obj = {it.nroRef, it.titulo, String.valueOf(it.cantidad), &quot;Cancelar&quot;};
            rowData[indCompra] = obj;
            indCompra++;
        });

<span class="nc" id="L363">        carrito = new JTable(rowData, columnNames);</span>
<span class="nc" id="L364">        carrito.setPreferredScrollableViewportSize(new Dimension(500, 100));</span>
<span class="nc" id="L365">        carrito.setFillsViewportHeight(true);</span>

<span class="nc" id="L367">        carrito.addMouseListener(new MouseAdapter() {</span>
            @Override
            public void mouseClicked(MouseEvent e) {
<span class="nc" id="L370">                cancelarLinea(e);</span>
<span class="nc" id="L371">            }</span>
        });

<span class="nc" id="L374">        JScrollPane scrollPane = new JScrollPane(carrito);</span>
<span class="nc" id="L375">        thirdPanel.add(scrollPane);</span>

<span class="nc" id="L377">        thirdPanel.revalidate();</span>
<span class="nc" id="L378">        thirdPanel.repaint();</span>
<span class="nc" id="L379">    }</span>

    public class Item {

        public String nroRef;
        public String titulo;
        public Integer cantidad;

<span class="nc" id="L387">        public Item(String nroRef, String titulo, Integer cantidad) {</span>
<span class="nc" id="L388">            this.nroRef = nroRef;</span>
<span class="nc" id="L389">            this.titulo = titulo;</span>
<span class="nc" id="L390">            this.cantidad = cantidad;</span>
<span class="nc" id="L391">        }</span>

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>